# 第一讲 数据文件的组织和索引技术

## 1.1 数据文件的组织

+ 字段的表示
  + 字段在定义的时候都会声明类型，这样就给字段在存储介质上面确定了存储空间
+ 记录的表示
  + **定长记录**：它所包含的所有字段
  + **变长记录**：允许包含**变长字段**，有多种表示方法
+ 记录集合的存储结构
  + **物理邻接存储**
    + 插入删除频繁不是很方便
  + **指针连接存储**
+ 数据文件组织形式
  + **堆文件**
  + **顺序文件**
    + 按照某个**搜索码**的值的顺序进行存储
    + 插入删除不是很方便
  + **散列文件**
    + 直接存取文件/哈希文件
    + 利用**哈希函数**，将具有**相同搜索码值**的记录散列存到外存(通常是磁盘上)的同地址范围中
    + **优点**
      + 记录随机存放，不需进行排序，所以插入、删除方便，存取速度快，节省存储空间
    + **缺点**
      + 只支持随机检索，不支持范围查询
      + 哈希函数的选择不是很容易
  + **聚簇文件**
    + 每块可存储多个相关联的关系

## 1.2 索引的概念和分类

+  目的
  + 提高查询效率
+ 索引记录结构
  + 索引记录：由一个搜索码值和指向具有该搜索码值的一个或多个记录的指针构成
  + <img src="C:\Users\包志龙\Desktop\常用\file\mark down笔记\图片\Snipaste_2020-03-18_20-56-27.png" style="zoom:80%;" />
+ 种类
  + 聚集索引
  + 非聚集索引
  + 稠密索引
  + 稀疏索引
  + 有序索引
  + 散列索引
+ **顺序文件索引**
  + 文件按照**搜索码**的顺序存储，索引记录按照**搜索码值**排序
  + <img src="C:\Users\包志龙\Desktop\常用\file\mark down笔记\图片\Snipaste_2020-03-18_20-59-45.png" style="zoom:80%;" />
  + **稀疏索引**
    + 查找相对慢，但是占据空间小，易于维护
    + 当**移动记录**过多时，可以使用**溢出块**的方式减少移动
  + **稠密索引**
    + 查找块，占据空间大，不易维护

## 1.3 B树索引

+ 是一种**多级索引**，采用的是**平衡树**的结构。
+ 平衡树，即**树根到树叶的所有路径都一样长。**
+ 通常是**三层**
+ 通常都有一个参数n，决定了B-树的所有存储块的布局
+ 一颗**m阶**的B树定义如下：
  + m表示最多有**m**个子节点
  + 根节点最少有**1**个关键字
  + **非根节点**至少有**ceil(m/2) -1** 个关键字(**ceil**表示**向上取整**)，最多有**m-1**个关键字
+ 存储块存放n个查找键值和n+1个指针
+ **删除节点**操作：
  + 如果当前需要从**非叶子节点**进行删除，则需要用后继key覆盖需要删除的key,然后在后继key中删除掉后继key.
  + 该节点key 个数大于等于ceil(m/2) -  1,结束删除操作，否则执行下一步
  + 如果兄弟节点key个数大于ceil(m/2)-1，则**父节点中的key下移到该节点**，**兄弟节点中的key上移**，删除操作结束
  + 否则将**父节点中的key下移与当前节点及它的兄弟节点key合并，形成一个新的节点**
  + 有些节点可能既有左，又有右兄弟，我们可以任意选择一个兄弟进行操作
+ 节点类型
  + 根节点
  + 叶节点
  + 非叶节点
+ **特点**
  + 可以作为主索引，也可以作为辅助索引
  + 可以是稀疏索引，也可以是稠密索引
+ **查询**
  + 支持**随机查询**
  + 也支持**范围查询**
  + 方法是从根节点到叶节点进行遍历
+ **维护**
  + `插入`
    + 节点分裂
  + `删除`
    + 节点合并

## 1.4 B+树索引

+ 定义
  + **关键字个数比孩子个数少一**
+ 两种类型的节点
  + 内部节点
  + 叶子节点
+ 特点：**数据只保存在叶子节点，其他只存储索引**

## 1.5 散列索引

+ 定义
  + 散列函数h将搜索码值K，利用h(K)将记录分布到B个桶当中的技术，根据B是否固定，可以分为**静态散列**和**动态散列**两种方法

+ 分类
  + 动态散列
    + **可扩展散列**
      + 桶的数量随着记录的变化而变化
      + 多个桶可以共享存储块
      + 桶数量的确定方法
      + 优点
        + 直接寻址，支持随机查找
        + 扩展代价比较昂贵
        + 散列函数的寻找比较难
    + 线性散列
    + 分块散列
  + 静态散列

# 第二章 索引结构

## 2.1 索引结构基础

+ 主索引
  + 能确定记录在**数据文件中的位置**，而辅助索引不行

### 2.1.1 顺序文件

+ 对关系中的元组按照**主键**进行排序而生成的文件。
+ **溢出块**

### 2.1.2 稠密索引

+ 索引块保持键的顺序与文件中的排序顺序一致。
+ <img src="C:\Users\包志龙\Desktop\常用\file\mark down笔记\图片\Snipaste_2020-03-19_14-52-56.png" style="zoom:80%;" />

### 2.1.3 稀疏索引

+ 只对数据文件的每个**存储块**设置一个键值对，比稀疏索引节省了很多存储空间。
+ 键值是每个数据块中**第一个记录**的对应值
+ <img src="C:\Users\包志龙\Desktop\常用\file\mark down笔记\图片\Snipaste_2020-03-19_14-57-41.png" style="zoom:80%;" />