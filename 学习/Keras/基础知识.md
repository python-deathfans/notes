## 具体使用(回调函数)

### ModelCheckpoint 与 EarlyStopping 回调函数

+ 如果监控的目标指标在**设定的轮数内不再改善**，可以用 **EarlyStopping** **回调函数来中断**训练。比如，这个回调函数可以在刚开始过拟合的时候就中断训练，从而避免用更少的轮次重新训练模型。这个回调函数通常与 **ModelCheckpoint** 结合使用，后者可以在训练过程中持续不断地**保存模型**（**你也可以选择只保存目前的最佳模型，即一轮结束后具有最佳性能的模型**） 

+ 由于需要验证验证集，所以需要传入验证集

+ ```
  callbacks_list = [
  	keras.callbacks.EarlyStopping(#如果不再改善，就中断训练
  	monitor='acc',
  	patience=1,#如果精度在多于一轮的时间（即两轮）内不再改善，中断训练
  ),
  keras.callbacks.ModelCheckpoint(
  	filepath='my_model.h5',
  	monitor='val_loss',#这两个参数的含义是，如果val_loss 没有改善，那么不需要覆盖模型文件。这就可以始终保存在训练过程中见到的最佳模型
  	save_best_only=True,
  )
  ]
  ```

  ### ReduceLROnPlateau

  + 如果**验证损失不再改善**，你可以使用这个回调函数来降低学习率。在训练过程中如果出现了损失平台（loss plateau） ，那么**增大或减小学习率**都是跳出局部最小值的有效策略
  
+ ```
    callbacks_list = [
    	keras.callbacks.ReduceLROnPlateau(
    		monitor='val_loss'
    		factor=0.1,#触发时将学习率除以10
    		patience=10,#如果验证损失在10 轮内都没有改善，那么就触发这个回调函数
    	)
    ]
    ```
  
  ## TensorBoard
  
  > TensorBoard 的主要用途是， 在训练过程中帮助你以**可视化的方法监控模型内部发生的一切**。
    > 如果你监控了除模型最终损失之外的更多信息， 那么可以更清楚地了解模型做了什么、 没做什么，
    > 并且能够更快地取得进展。TensorBoard 具有下列巧妙的功能，都在浏览器中实现。
  
+ ```
    callbacks = [ 
        keras.callbacks.TensorBoard( 
            log_dir='my_log_dir',   
            histogram_freq=1,   
            embeddings_freq=1,   
        ) 
    ]
    ```
  
+ 运行方式
  
  + **tensorboard --logdir=my_log_dir**
    + 打开浏览器，输入 **http://localhost:6006**

## 迁移学习

> 想要将深度学习应用于**小型图像数据集**，一种常用且非常高效的方法是使用**预训练网络**。预训练网络（pretrained network）是一个保存好的网络，之前已在大型数据集（通常是大规模图像分类任务）上训练好。

+ `特征提取`
  + 特征提取是使用之前网络学到的表示来从新样本中**提取出有趣的特征**。然后将这些特征输入一个**新的分类器**，从头开始训练。
  + 用于图像分类的**卷积神经网络包含两部分**：首先是`一系列池化层和卷积层`，最后是一个`密集连接分类器`。第一部分叫作模型的`卷积基`（convolutional base） 。对于卷积神经网络而言，特征提取就是取出之前训练好的网络的卷积基，在上面运行新数据，然后在输出上面训练一个`新的分类器`
  + ![](https://pic.downk.cc/item/5f06b4a814195aa5946503ce.png)
+ **卷积基学到的表示可能更加通用，因此更适合重复使用**
+ `分类器`学到的表示必然是`针对于模型训练`的类别，其中仅包含某个类别出现在整张图像中的概率信息。此外，密集连接层的表示不再包含物体在输入图像中的位置信息。密集连接层舍弃了空间的概念，而物体位置信息仍然由卷积特征图所描述。如果物体位置对于问题很重要，那么密集连接层的特征在很大程度上是无用的
+ 某个卷积层提取的表示的通用性（以及可复用性）取决于该层在模型中的深度。模型中`更靠近底部的层`提取的是`局部的、高度通用`的特征图（比如视觉边缘、颜色和纹理） ，而`更靠近顶部的层提取的是更加抽象`的概念（比如“猫耳朵”或“狗眼睛” ） 。
+ `微调模型`





